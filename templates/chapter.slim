doctype html
html lang='en'
  head
    meta charset='utf-8'
    title ŚB #{canto}.#{number}-t, #{title}

    meta[name="viewport" content="width=device-width, initial-scale=1.0"]
    link[rel="stylesheet" href="https://stackedit.io/style.css"]
    link[rel="preconnect" href="https://fonts.gstatic.com"]
    link[href="https://fonts.googleapis.com/css2?family=Manuale:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto+Slab&display=swap" rel="stylesheet"]
    script[src="https://code.jquery.com/jquery-3.6.0.slim.min.js"]

    javascript: 
      $(document).ready(function() {
      
        current_verse_highlighted = false;
      
        $('.verse_num').click(function() {
          console.log('haribol!')
          current_verse_highlighted = $(this).parents('.verse')[0]
          toggleVerseHighlight(current_verse_highlighted)
      
        })

      
        $(document).keydown(function(event) {
          if (current_verse_highlighted != false) {
            const callback = {
              'ArrowUp'   : moveHighlightToPrevVerse,
              'ArrowDown' : moveHighlightToNextVerse,
            }[event.key]
            callback?.(event)
          }
        })
      
      });
      

      function toggleVerseHighlight(verseElement, scrollToCenter = false) {
        el = $($(verseElement).find('.verse_translation')[0]).toggleClass('current_para_highlight').get(0)
        if (scrollToCenter) {
          el.scrollIntoView({behavior: 'smooth', block: 'center'})
        }
      }


      function moveHighlightToNextVerse(event) {
        event.preventDefault()
        toggleVerseHighlight(current_verse_highlighted)
        current_verse_highlighted = $(current_verse_highlighted).next()
        toggleVerseHighlight(current_verse_highlighted, true)

      }
      
      function moveHighlightToPrevVerse(event) {
        event.preventDefault()
        toggleVerseHighlight(current_verse_highlighted)
        current_verse_highlighted = $(current_verse_highlighted).prev()
        toggleVerseHighlight(current_verse_highlighted, true)
      }

    css: 
      body {
        color: #111;
        font-size: 24px;
        font-family: 'Times New Roman', 'Manuale', serif;
        font-variant-ligatures: common-ligatures;
        line-height: 1.67;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background-color: antiquewhite;
      }
      .verse_translation {
        font-weight: bold;
        text-indent: -2rem;
      }
      .verse_num {
        /* display: block; */
        /* position: absolute; */
        text-align: right;
        color: #555;
        font-size: 0.9em;
        /* margin-left: -5rem; */
        /* margin-right: 1rem; */
      }
      .text_source_copied_date {
        display: block;
        font-size: 0.8em;
        color: #555;
      }
      .current_para_highlight {
        border: 1px dotted;
        padding: 1rem;
        background: rgba(0,0,108,0.2);
        font-weight: bold;
      }

  body.stackedit
    div.stackedit__html
      h2 Śrīmad-Bhāgavatam, Canto #{canto}:<br>
        #{Bhāgavatamr::CANTOS[canto.to_i]}

      h1 #{fancy_number}:<br>#{title}
      - verses.each do |verse_num, verse|
        div.verse data-verse_num="#{verse_num}"
          .verse_translation
            p
              span.verse_num
                | [#{verse.num_range}.] 
              = verse.english_translation_text

      p 
        em == thus_ends_text
      hr
      p 
        | Text copied from: 
        a href="#{text_source_url}" #{text_source_url}
        / br
        /!  span.text_source_copied_date
          | on #{date_text_copied_from_source} 
      p == next_prev_links_raw